---
title: "CAPÍTULO IV. TRABAJO EN EL HOGAR Y DE CUIDADOS (TRABAJO NO REMUNERADO) Y LA
  DEPENDENCIA ECONÓMICA"
author: "Edgardo Flores Gutiérrez"
date: "2025-09-28"
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    collapsed: true
    smooth_scroll: true
    theme: journal
    highlight: kate
    df_print: paged
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, include=TRUE)
```

## Introducción

El siguiente análisis se sustenta en la ENIGH tabla "poblacion" del 2024 publicada por el INEGI, centrándose en la tabla de datos "poblacion", que nos permite conocer las características sociodemográficas y ocupacionales de los integrantes del hogar, ademas de la variable tam_loc que indica el tamaño de localidad, que se encuentra en la tabla viviendas.

La encuesta contiene un diseño muestral estatrificado, con representatividad nacional y subnacional, por lo que, la encuesta cuenta con tres variables para la realización del diseño muestral y realizar inferencia estadística:

1.  factor: peso de expansión

2.  est_dis: estrato

3.  upm: unidad primaria de muestreo.

El análisis tiene como objetivo conocer el trabajo no remunerado en el hogar con un enfoque de género, identificando las horas dedicadas a actividades que no son remuneradas y la dependencia económica de las mujeres dentro de los hogares.

Estructura del análisis:

-   Definición del diseño muestral

-   Análisis estadístico por segmento:

    -   Medidas de tendencia central

    -   Comparación de medias y medianas entre grupos

-   Visualización de resultados (Data visualization)

-   Modelo de regresión final con ajuste por diseño muestral (opcional)

```{r}
# Cargar dataset
url_raw <- "https://raw.githubusercontent.com/Edgardo2501/Data_Analysis_Projects/refs/heads/main/trabajo_no_remunerado.csv"

data_trabajo_no_remunerado <- read.csv(url_raw)
```

```{r}
# Cargar paquetes
library(tidyverse)
library(survey)
library(ggthemes)
library(scales)
library(lubridate)
library(hms)
```

## Diseño muestral

El diseño muestral con el que fue recolectada la ENIGH 2024 valida los resultados del análisis estadístico,

De acuerdo con el documento metodológico de la ENIGH 2024 Nueva Serie Descripción de la base de datos (INEGI, Capítulo 4) est_dis corresponde a un código de estrato estadístico definido por características como: • Nivel de urbanización (urbano/rural) • Tamaño de localidad • Categoría de la entidad federativa (grande, mediana, pequeña) • Dominio de estudio (entidad, ciudad, región)

UPM identifica cada Unidad Primaria de Muestreo, que en zonas urbanas equivale generalmente a una manzana o conjunto de manzanas, y en zonas rurales, a localidades. Las UPM se seleccionan con probabilidad proporcional al tamaño poblacional, y constituyen la base para la selección de viviendas.

Factor: el factor de expansión constituye el peso que se le da a cada unidad muestral para generalizar los resultados de la muestra a la población.

El **diseño muestral** es el plan o estrategia que se utiliza para seleccionar una muestra a partir de una población más grande. En esencia, es el conjunto de procedimientos que nos permite elegir un subgrupo representativo (la muestra) de un grupo total (la población) con el fin de estudiarlo y poder generalizar los resultados a toda la población.

El objetivo principal es obtener información precisa y confiable sobre la población sin tener que estudiar a cada uno de sus individuos, lo que a menudo sería demasiado costoso, lento o simplemente imposible.

```{r}
# Definición del diseño muestral
# Declarar el diseño de la encuesta para la tabla 'trabajo_no_remunerado'
# ids: Especifica las Unidades Primarias de Muestreo (~upm)
# strata: Especifica los estratos (~est_dis)
# weights: Especifica el factor de expansión (~factor)
# nest = TRUE: Indica que las UPM están anidadas dentro de los estratos

enigh_design <- svydesign(ids = ~upm, 
                          strata = ~est, 
                          weights = ~factor, 
                          data = data_trabajo_no_remunerado, 
                          nest = TRUE)
```

## Análisis estadístico

Para realizar un análisis estádistico correcto, es preciso conocer la cantidad de personas que representa el diseño muestral, así como las medidas de tendencia central.

Población total que realiza trabajo no remunerado (por sexo)

```{r}
# Calcular el total de la población que realiza trabajo no remuenrado de México por sexo
poblacion_total <- svytotal(~sexo, design = enigh_design)
poblacion_total <- as.data.frame(poblacion_total)
poblacion_total$Total <- comma(poblacion_total$total)
poblacion_total$Error_Estandar <- comma(poblacion_total$SE)

poblacion_total %>% 
  select(Total, Error_Estandar)
```

```{r}
# Total de personas que realizan trabajo no remunerado en México
total_personas_grupo <- sum(poblacion_total$total)

cat("El número total de personas (población expandida) que realizan trabajo no remunerado es:", 
    comma(total_personas_grupo, accuracy = 1))
```

### Edad

-   Edad promedio y mediana de la población que realiza trabajo no remunerado (por sexo)

```{r}
# Calcular la edad promedio desagregada por sexo
edad_promedio_por_sexo <- svyby(~edad, by = ~sexo, design = enigh_design, FUN = svymean)
```

```{r}
# Calcular la mediana de la edad desagregada por sexo
# svyquantile para especificar el cuantil 0.5 (mediana).
edad_mediana_por_sexo <- svyby(~edad, 
                            by = ~sexo, 
                            design = enigh_design, 
                            FUN = svyquantile, 
                            quantiles = 0.5,
                            ci = TRUE) # ci=TRUE para el intervalo de confianza
```

```{r}
# Renombrar nombres de columnas
colnames(edad_promedio_por_sexo)[2] <- "media"
colnames(edad_promedio_por_sexo)[3] <- "se_media"
colnames(edad_mediana_por_sexo)[2] <- "mediana"
colnames(edad_mediana_por_sexo)[3] <- "se_mediana"

# Unir los dos data frames en uno solo
# Usamos la función merge() para unir por la columna 'sexo'
estadisticas_finales <- merge(edad_promedio_por_sexo, edad_mediana_por_sexo, by = "sexo")

# Redondear resultados
estadisticas_finales <- estadisticas_finales %>%
  mutate(media = round(media, 0))
  
# mutate(across(where(is.double), ~ round(., 0))) -> Redondea todas las columnas con el formato db. 

# Imprimir la tabla final con media y mediana
print(estadisticas_finales)
```

```{r fig.width=10, fig.height=7}
edad_promedio_por_sexo %>% 
  ggplot(aes(x = sexo, y = media, fill = sexo)) +
  geom_col() +
  geom_text(aes(label = round(media), vjust = -0.5, size = 1)) +
  labs(
    title = "Gráfica 1. Promedio de edad",
    subtitle = "Población que realiza trabajo no remunerado. (Agrupado por sexo)",
    x = "",
    y = ""
  ) +
  theme_minimal() +
  theme(
    legend.position = "NONE",
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 12),
    axis.title = element_text(size = 12, face = "bold")) +
  scale_fill_manual(values = c("Hombre" = "orchid3", "Mujer" = "steelblue"))
```

```{r}
# Gráfico de boxplot para analizar la dispersión de la edad
data_trabajo_no_remunerado %>% 
  ggplot(aes(x = sexo, y = edad, fill = sexo)) +
  geom_boxplot() +
  labs(
    title = "Gráfica 2. Distribución de la edad promedio",
    subtitle = "Población que realiza trabajo no remunerado"
  ) +
  theme_clean() +
  theme(legend.position = "") +
  scale_fill_manual(values = c("Hombre" = "orchid3", "Mujer" = "steelblue"))
```

### Horas

-   Horas semanales promedio y mediana de trabajo no remunerado (por sexo)

```{r}
# Calcular las horas promedio de trabajo no remunerado por sexo
horas_promedio_por_sexo <- svyby(~horas_tnr, by = ~sexo, design = enigh_design, FUN = svymean)
```

```{r}
horas_mediana_por_sexo <- svyby(~horas_tnr, 
                            by = ~sexo, 
                            design = enigh_design, 
                            FUN = svyquantile, 
                            quantiles = 0.5,
                            ci = TRUE) # ci=TRUE para el intervalo de confianza
```

```{r}
colnames(horas_promedio_por_sexo)[2] <- "media"
colnames(horas_promedio_por_sexo)[3] <- "se_media"
colnames(horas_mediana_por_sexo)[2] <- "mediana"
colnames(horas_mediana_por_sexo)[3] <- "se_mediana"

# Unir los dos data frames en uno solo
# Usamos la función merge() para unir por la columna 'sexo'
estadisticas_finales_horas <- merge(horas_promedio_por_sexo, horas_mediana_por_sexo, by = "sexo")

# Crear columnas con formato hh:mm:ss
estadisticas_finales_horas <- estadisticas_finales_horas %>%
  mutate(
    media_hm = as_hms(media * 3600),
    mediana_hm = as_hms(mediana * 3600)
  )

# Usamos round_hms() con digits = 0 para redondear al segundo más cercano
estadisticas_finales_horas <- estadisticas_finales_horas %>%
  mutate(
    media_hm = round_hms(media_hm, digits = 0),
    mediana_hm = round_hms(mediana_hm, digits = 0)
  )

# Imprimir el resultado final
print(estadisticas_finales_horas)
```

```{r fig.width=10, fig.height=7}
estadisticas_finales_horas %>% 
  ggplot(aes(x = sexo, y = media_hm, fill = sexo)) +
  geom_col() +
  geom_text(aes(label = media_hm), vjust = -0.5, size = 4) +
  labs(
    title = "Gráfica 3. Promedio de horas a la semana de trabajo no remunerado",
    subtitle = "",
    x = "",
    y = ""
  ) +
  theme_clean() +
  theme(legend.position = "NA") +
  scale_fill_manual(values = c("Hombre" = "orchid3", "Mujer" = "steelblue"))
```

```{r fig.width=10, fig.height=7}
# Gráfico de boxplot para analizar la dispersión de las horas de trabajo no remunerado
data_trabajo_no_remunerado %>% 
  ggplot(aes(x = sexo, y = horas_tnr, fill = sexo)) +
  geom_boxplot() +
  labs(
    title = "Gráfica 4. Distribución de las horas a la semana de trabajo no remunerado",
    subtitle = "(Promedio por sexo)",
    y = "",
    x = ""
  ) +
  theme_minimal() +
  theme(legend.position = "") +
  scale_fill_manual(values = c("Hombre" = "orchid3", "Mujer" = "steelblue"))
```

Dada la fuerte asimetria y la gran cantidad de valores atípicos (outliers) en las horas de trabajo no remunerado (Gráfica 4), la **mediana** es una medida de tendencia central mucho más adecuada y robusta que la **media**.

### Horas de trabajo no remunerado (por etnia y sexo)

```{r}
# Gráfico de boxplot para la variable etnia, desagregado por sexo
data_trabajo_no_remunerado %>% 
  ggplot(aes(x = etnia, y = horas_tnr, fill = etnia)) +
  geom_boxplot() +
  # Separamos el gráfico en dos: uno para Hombres y otro para Mujeres
  facet_wrap(~ sexo) + 
  labs(
    title = "Gráfica 5. Distribución de horas por semana de trabajo no remunerado",
    subtitle = "Promedio por etnia y sexo",
    x = "Etnia",
    y = ""
  ) +
  theme_minimal() +
  # Rotamos las etiquetas del eje X si son muy largas
  theme(axis.text.x = element_text(angle = 0, hjust = 1), 
        legend.position = "") +
  scale_fill_manual(values = c("Si" = "orchid3", "No" = "steelblue"))
```

### Horas de trabajo no remunerado (por afrodescendencia y sexo)

```{r}
data_trabajo_no_remunerado %>% 
  ggplot(aes(x = afrod, y = horas_tnr, fill = afrod)) +
  geom_boxplot() +
  # Separamos el gráfico en dos: uno para Hombres y otro para Mujeres
  facet_wrap(~ sexo) + 
  labs(
    title = "Gráfica 6. Distribución de horas por semana de trabajo no remunerado",
    subtitle = "Agrupado por afrodescendencia y sexo",
    x = "Afrodescendencia",
    y = ""
  ) +
  theme_minimal() +
  # Rotamos las etiquetas del eje X si son muy largas
  theme(axis.text.x = element_text(angle = 0, hjust = 1), 
        legend.position = "")
```

### Horas semanales de trabajo no remunerado (zona y sexo)

```{r}
data_trabajo_no_remunerado %>% 
  ggplot(aes(x = zona, y = horas_tnr, fill = zona)) +
  geom_boxplot() +
  # Separamos el gráfico en dos: uno para Hombres y otro para Mujeres
  facet_wrap(~ sexo) + 
  labs(
    title = "Gráfica 7. Distribución de horas por semana de trabajo no remunerado",
    subtitle = "Agrupado por zona y sexo",
    x = "Zona",
    y = ""
  ) +
  theme_minimal() +
  # Rotamos las etiquetas del eje X si son muy largas
  theme(axis.text.x = element_text(angle = 0, hjust = 1), 
        legend.position = "")
```

### Horas de trabajo no remunerado (por región y sexo)

```{r}
data_trabajo_no_remunerado %>% 
  ggplot(aes(x = region, y = horas_tnr, fill = region)) +
  geom_boxplot() +
  # Separamos el gráfico en dos: uno para Hombres y otro para Mujeres
  facet_wrap(~ sexo) + 
  labs(
    title = "Gráfica 8. Distribución de horas por semana de trabajo no remunerado",
    subtitle = "Agrupado por región y sexo",
    x = "Región",
    y = ""
  ) +
  theme_minimal() +
  # Rotamos las etiquetas del eje X si son muy largas
  theme(axis.text.x = element_text(angle = 0, hjust = 1), 
        legend.position = "")
```

### Normalización de la variable horas de trabajo no remunerado

```{r}
# Histograma para analizar la distribución de las horas de trabajo no remunerado
data_trabajo_no_remunerado %>% 
  ggplot(aes(horas_tnr)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black") +
  labs(
    title = "Gráfica 9. Distribución de las horas a la semana de trabajo no remunerado",
    y = "",
    x = "Horas"
  ) +
  theme_minimal() +
  theme(legend.position = "")
```

Como se observa en la gráfica 9, la distribución está claramente "cargada" hacia la izquierda, con una cola larga hacia la derecha. Esto significa que la mayoría de las personas reportan una cantidad relativamente baja de horas de trabajo no remunerado, pero un número menor de personas reporta una cantidad extremadamente alta. **La media no es representativa:** En una distribución como esta, la media aritmética será afectada por los valores altos, provocando un valor central inflado . La **mediana** será una medida mucho más robusta de lo que hace la "persona típica".

#### Transformación Logarítimica

Con la intención de normalizar los datos, se realiza una transformación logarítmica. El objetivo es crear una nueva columna que contenga el logaritmo de las horas de trabajo no remunerado.

#### Justificación de la Transformación Logarítmica

La decisión de transformar una variable $Y$ a $log(Y)$ no es una medida arbitraria para alterar la escala de los datos, sino un procedimiento estándar en econometría y estadística que se justifica por una o más de las siguientes razones teóricas y prácticas:

-   **Mecanismo de Acción:** La función logarítmica es cóncava, lo que significa que "comprime" la escala de los valores altos en mayor medida que la de los valores bajos. Esto reduce el impacto de los valores extremos en la cola derecha de la distribución, resultando en una distribución transformada mucho más simétrica y, a menudo, aproximadamente normal.

-   **Beneficio Estadístico:** Al normalizar la distribución de la variable (o, más precisamente, la de los residuos del modelo), se obtienen estimadores más eficientes y se valida el uso de pruebas de significancia (valores p) y la construcción de intervalos de confianza, los cuales dependen del supuesto de normalidad.

```{r}
# 1. Aplicar la transformación logarítmica
data_trabajo_no_remunerado <- data_trabajo_no_remunerado %>%
  mutate(horas_log = log1p(horas_tnr))

# 2. Visualizar la distribución ANTES y DESPUÉS de la transformación

# Gráfica de la distribución antes de la transformación:
plot_original <- ggplot(data_trabajo_no_remunerado, aes(x = horas_tnr)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black") +
  labs(title = "Distribución sin normalizar",
       x = "Horas de trabajo no remunerado",
       y = "Frecuencia") +
  theme_minimal()

# Gráfica de la distribución transformada
plot_transformada <- ggplot(data_trabajo_no_remunerado, aes(x = horas_log)) +
  geom_histogram(bins = 30, fill = "lightgreen", color = "black") +
  labs(title = "Distribución con Transformación Logarítmica",
       x = "log(Horas + 1)",
       y = "Frecuencia") +
  theme_minimal()

plot_original
plot_transformada
```

```{r}
# 1. Calcular las tres métricas clave para comparar
media_original <- mean(data_trabajo_no_remunerado$horas_tnr)
mediana_original <- median(data_trabajo_no_remunerado$horas_tnr)

# 2. Calcular la media de la variable transformada
media_log <- mean(data_trabajo_no_remunerado$horas_log)

# 3. Revertir la transformación para obtener la media geométrica
media_geometrica <- exp(media_log) - 1

# 4. Imprimir y comparar los resultados
print(paste("Media Aritmética Original (sesgada):", round(media_original, 2)))
print(paste("Mediana Original (robusta):", round(mediana_original, 2)))
print(paste("Media Geométrica (robusta e interpretable):", round(media_geometrica, 2)))
```

## Comparación de medias y medianas entre grupos

```{r}
# 1. Calcular la MEDIA de 'trabajo_no_remunerado' por cada grupo de interés
media_por_grupos <- svyby(~horas_tnr, # Indicar la variable a calcular
                           by = ~sexo + entidad + etnia + afrod, 
                           design = enigh_design, 
                           FUN = svymean, index = FALSE)


# Visualizarr los primeros registros de cada tabla de resultados
head(media_por_grupos)
```

```{r}
# 2. Calcular la MEDIANA de 'trabajo_no_remunerado' por los mismos grupos
# svyquantile para especificar el cuantil 0.5 (mediana).
mediana_por_grupos <- svyby(~horas_tnr, 
                            by = ~sexo + entidad + etnia + afrod, 
                            design = enigh_design, 
                            FUN = svyquantile, 
                            quantiles = 0.5,
                            ci = TRUE) # ci=TRUE para el intervalo de confianza
head(mediana_por_grupos)
```

## Visualización de resultados

Gráficos:

```{r fig.width=10, fig.height=7}

# Gráfica. Promedio de horas de trabajo no remunerado por sexo
trabajo_nr_por_sexo <- data_trabajo_no_remunerado %>% 
  group_by(sexo) %>% 
  summarise(media_tnr = mean(horas_tnr), .groups = 'drop')
  
# Convertir horas a formato hh:mm:ss
trabajo_nr_por_sexo <- trabajo_nr_por_sexo %>% 
    mutate(
    media_hm = as_hms(media_tnr * 3600)
  )

ggplot(trabajo_nr_por_sexo, aes(x = sexo, y = media_hm, fill = sexo)) +
  geom_bar(stat = "identity", color = "black", linewidth = 0.8, width = 0.5) +
  geom_text(aes(label = round_hms(media_hm, 2),vjust = -0.5, size = 1)) +
  labs(title = "Gráfica 1. Promedio de horas semanales de trabajo no remunerado en 2024",
       subtitle = "(Comparación por sexo)",
       x = "",
       y = "",
       caption = "Fuente: Elaboración propia con base a la ENIGH 2024, INEGI"
  ) +
  theme_minimal() +
  theme(
    legend.position = "NONE",
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 12),
    axis.title = element_text(size = 12, face = "bold")
  ) +
  scale_fill_manual(values = c("Hombre" = "orchid3", "Mujer" = "steelblue"))

```

### Gráficas con media normalizada

```{r fig.width=10, fig.height=7}

# Gráfica 1. Promedio de horas de trabajo no remunerado por sexo
trabajo_nr_por_sexo <- data_trabajo_no_remunerado %>% 
  group_by(sexo) %>% 
  summarise(medialog_tnr = mean(horas_log), .groups = 'drop')
  # summarise(median_tnr = median(horas_tnr), .groups = 'drop')

# Tranformación de la variable horas_log
trabajo_nr_por_sexo <- trabajo_nr_por_sexo %>%
  mutate(mediageom_tnr = exp(medialog_tnr) - 1)
  
# Convertir horas a formato hh:mm:ss
trabajo_nr_por_sexo <- trabajo_nr_por_sexo %>% 
    mutate(
    media_hm = as_hms(mediageom_tnr * 3600)
    #mediana_hm = as_hms(median_tnr * 3600)
  )

ggplot(trabajo_nr_por_sexo, aes(x = sexo, y = mediageom_tnr, fill = sexo)) +
  geom_bar(stat = "identity", color = "black", linewidth = 0.8, width = 0.5) +
  geom_text(aes(label = round_hms(media_hm, 2),vjust = -0.5, size = 1)) +
  labs(title = "Gráfica 1. Promedio de horas semanales de trabajo no remunerado en 2024",
       subtitle = "(Comparación por sexo)",
       x = "",
       y = "",
       caption = "Fuente: Elaboración propia con base a la ENIGH 2024, INEGI"
  ) +
  theme_minimal() +
  theme(
    legend.position = "NONE",
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 12),
    axis.title = element_text(size = 12, face = "bold")
  ) +
  scale_fill_manual(values = c("Hombre" = "orchid3", "Mujer" = "steelblue"))
```

```{r fig.width=10, fig.height=7}
# Gráfica 2. Mediana de horas de trabajo no remunerado por sexo y etnia
trabajo_nr_por_etnia <- data_trabajo_no_remunerado %>% 
  group_by(etnia, sexo) %>% 
  summarise(medialog_tnr = mean(horas_log), .groups = 'drop')

# Tranformación de la variable horas_log
trabajo_nr_por_etnia <- trabajo_nr_por_etnia %>%
  mutate(mediageom_tnr = exp(medialog_tnr) - 1)

# Convertir horas a formato hh:mm:ss
trabajo_nr_por_etnia <- trabajo_nr_por_etnia %>% 
    mutate(
    media_hm = as_hms(mediageom_tnr * 3600)
  )

ggplot(trabajo_nr_por_etnia, aes(x = sexo, y = mediageom_tnr, fill = etnia)) +
  geom_col(color = "black", position = "dodge", linewidth = 0.8) +
  geom_text(aes(label = round_hms(media_hm, 2)),
            position = position_dodge(width = 1),
            vjust = -0.5, 
            size = 3.5,
            color = "black") +
  labs(title = "Gráfica 2. Promedio de horas semanales de trabajo no remunerado en 2024",
       subtitle = "(Agrupado por etnia y sexo)",
       x = "",
       y = "",
       caption = "Fuente: Elaboración propia con base a la ENIGH 2024, INEGI"
  ) +
  theme_minimal()+
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 12),
    axis.title = element_text(size = 12, face = "bold"),
    axis.text.y = element_blank()
  ) +
  scale_fill_manual(values = c("Si" = "darkgreen", "No" = "orange"))
```

```{r fig.width=10, fig.height=7}
# Gráfica 3. Promedio de horas de trabajo no remunerado por afrodescendencia y sexo
trabajo_nr_por_afrod <- data_trabajo_no_remunerado %>% 
  group_by(afrod, sexo) %>% 
  summarise(medialog_tnr = mean(horas_log), .groups = 'drop')

# Tranformación de la variable horas_log
trabajo_nr_por_afrod <- trabajo_nr_por_afrod %>%
  mutate(mediageom_tnr = exp(medialog_tnr) - 1)

# Convertir horas a formato hh:mm:ss
trabajo_nr_por_afrod <- trabajo_nr_por_afrod %>% 
    mutate(
    media_hm = as_hms(mediageom_tnr * 3600)
  )

ggplot(trabajo_nr_por_afrod, aes(x = sexo, y = mediageom_tnr, fill = afrod)) +
  geom_col(color = "black", position = "dodge", size = 0.8) +
  geom_text(aes(label = round_hms(media_hm, 2)),
            position = position_dodge(width = 1),
            vjust = -0.5, 
            size = 3.5,
            color = "black") +
  labs(title = "Gráfica 3. Promedio de horas semanales de trabajo no remunerado en 2024",
       subtitle = "(Agrupado por afrodescendencia y sexo)",
       x = "",
       y = "",
       caption = "Fuente: Elaboración propia con base a la ENIGH 2024, INEGI"
  ) +
  theme_minimal()+
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 12),
    axis.title = element_text(size = 12, face = "bold"),
    axis.text.y = element_blank()
  ) +
  scale_fill_manual(values = c("Si" = "#6495ED", "No" = "#8B0000"))
```

```{r fig.width=10, fig.height=7}
# Gráfica 4. Promedio de horas de trabajo no remunerado por zona y sexo
trabajo_nr_por_zona <- data_trabajo_no_remunerado %>% 
  group_by(zona, sexo) %>% 
  summarise(medialog_tnr = mean(horas_log), .groups = 'drop')

# Tranformación de la variable horas_log
trabajo_nr_por_zona <- trabajo_nr_por_zona %>%
  mutate(mediageom_tnr = exp(medialog_tnr) - 1)

# Convertir horas a formato hh:mm:ss
trabajo_nr_por_zona <- trabajo_nr_por_zona %>% 
    mutate(
    media_hm = as_hms(mediageom_tnr * 3600)
  )

ggplot(trabajo_nr_por_zona, aes(x = sexo, y = mediageom_tnr, fill = zona)) +
  geom_col(color = "black", position = "dodge", size = 0.8) +
  geom_text(aes(label = round_hms(media_hm,2)),
            position = position_dodge(width = 1),
            vjust = -0.5, 
            size = 3.5,
            color = "black") +
  labs(title = "Gráfica 4. Promedio de horas semanales de trabajo no remunerado en 2024",
       subtitle = "(Agrupado por zona y sexo)",
       x = "",
       y = "",
       caption = "Fuente: Elaboración propia con base a la ENIGH 2024, INEGI"
  ) +
  theme_minimal()+
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 12),
    axis.title = element_text(size = 12, face = "bold"),
    axis.text.y = element_blank()
  ) +
  scale_fill_manual(values = c("Urbana" = "#66CDAA", "Rural" = "#0000CD"))
```

```{r fig.width=10, fig.height=7}
# Gráfica 5. Mediana de horas de trabajo no remunerado por discapacidad y sexo
trabajo_nr_por_disc <- data_trabajo_no_remunerado %>% 
  group_by(discapacidad, sexo) %>% 
  summarise(medialog_tnr = mean(horas_log), .groups = 'drop')

# Tranformación de la variable horas_log
trabajo_nr_por_disc <- trabajo_nr_por_disc %>%
  mutate(mediageom_tnr = exp(medialog_tnr) - 1)

# Convertir horas a formato hh:mm:ss
trabajo_nr_por_disc <- trabajo_nr_por_disc %>% 
    mutate(
    media_hm = as_hms(mediageom_tnr * 3600)
  )

ggplot(trabajo_nr_por_disc, aes(x = sexo, y = mediageom_tnr, fill = discapacidad)) +
  geom_col(color = "black", position = "dodge", size = 0.8) +
  geom_text(aes(label = round_hms(media_hm,2)),
            position = position_dodge(width = 1),
            vjust = -0.5, 
            size = 3.5,
            color = "black") +
  labs(title = "Gráfica 5. Promedio de horas semanales de trabajo no remunerado en 2024",
       subtitle = "(Agrupado por discapacidad y sexo)",
       x = "",
       y = "",
       caption = "Fuente: Elaboración propia con base a la ENIGH 2024, INEGI"
  ) +
  theme_minimal()+
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 12),
    axis.title = element_text(size = 12, face = "bold"),
    axis.text.y = element_blank()
  ) +
  scale_fill_manual(values = c("Si" = "#E6E6FA", "No" = "#9400D3"))
```

```{r fig.width=10, fig.height=7}
# Gráfica 6. Mediana de horas de trabajo no remunerado por region y sexo
trabajo_nr_por_reg <- data_trabajo_no_remunerado %>% 
  group_by(region, sexo) %>% 
  summarise(medialog_tnr = mean(horas_log), .groups = 'drop')

# Tranformación de la variable horas_log
trabajo_nr_por_reg <- trabajo_nr_por_reg %>%
  mutate(mediageom_tnr = exp(medialog_tnr) - 1)

# Convertir horas a formato hh:mm:ss
trabajo_nr_por_reg <- trabajo_nr_por_reg %>% 
    mutate(
    media_hm = as_hms(mediageom_tnr * 3600)
  )

ggplot(trabajo_nr_por_reg, aes(x = sexo, y = mediageom_tnr, fill = region)) +
  geom_col(color = "black", position = "dodge", size = 0.8) +
  geom_text(aes(label = round_hms(media_hm,2)),
            position = position_dodge(width = 1),
            vjust = -0.5, 
            size = 3.5,
            color = "black") +
  labs(title = "Gráfica 6. Promedio de horas semanales de trabajo no remunerado en 2024",
       subtitle = "(Agrupado por región y sexo)",
       x = "",
       y = "",
       caption = "Fuente: Elaboración propia con base a la ENIGH 2024, INEGI"
  ) +
  theme_minimal()+
  theme(
    legend.position = "top",
    legend.title = element_blank(),
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 12),
    axis.title = element_text(size = 12, face = "bold"),
    axis.text.y = element_blank()
  ) +
  scale_fill_manual(values = c("Norte" = "#104E8B", "Sur" = "#8B0000", "Centro" = "slategray1", "Occidente" = "#36648B" ))
```

#### Gráfico Combinado

```{r}

# Realizamos dataframes para cada variable
df1 <- trabajo_nr_por_sexo %>%
  mutate(
    desglose = "Promedio general",
    valor_desglose = sexo 
  )

df2 <- trabajo_nr_por_etnia %>%
  rename(valor_desglose = etnia) %>%  
  mutate(desglose = "Etnia")

df3 <- trabajo_nr_por_afrod %>%
  rename(valor_desglose = afrod) %>%
  mutate(desglose = "Afrodescendencia")

df4 <- trabajo_nr_por_zona %>%
  rename(valor_desglose = zona) %>%
  mutate(desglose = "Zona")

df5 <- trabajo_nr_por_disc %>%
  rename(valor_desglose = discapacidad) %>%
  mutate(desglose = "Discapacidad")

# df6 <- trabajo_nr_por_reg %>%
#  rename(valor_desglose = region) %>%
#  mutate(desglose = "Región")
```

```{r}
# Unimos todos los dataframes creados en un nuevo dataframe
data_combinada <- bind_rows(df1, df2, df3, df4, df5)
```

```{r}
# Definir orden exacto
orden_paneles <- c(
  "Promedio general", 
  "Etnia", 
  "Afrodescendencia", 
  "Discapacidad", 
  "Zona"
)

# Reescribe la columna 'desglose' como un factor ordenado
data_combinada <- data_combinada %>%
  mutate(desglose = factor(desglose, levels = orden_paneles))
```

```{r}
# Paleta de colores
paleta_colores <- c(
  "Hombre" = "#27408B", "Mujer" = "orchid4"
)
```

```{r fig.width=20, fig.height=10}
# Gráfica final
ggplot(data_combinada, aes(x = valor_desglose, y = mediageom_tnr, fill = sexo)) +
  geom_col(color = "black", position = "dodge", linewidth = 0.8) +
  geom_text(
    aes(label = round_hms(media_hm, 2)),
    position = position_dodge(width = 0.9),
    vjust = -0.5, 
    size = 4.5,
    color = "black",
  ) +
  # 'scales = "free_x"' elimina los espacios extra en el eje X
  facet_wrap(~ desglose, nrow = 1, scales = "free_x") +
  labs(
    title = "Promedio de horas semanales de trabajo no remunerado en 2024",
    subtitle = "Comparativa por sexo y otras variables de desagregación",
    caption = "\n Fuente: Elaboración propia con base a la ENIGH 2024, INEGI",
    x = NULL, 
    y = "",
    fill = ""
  ) +
  scale_fill_manual(values = paleta_colores) + 
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 24, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 16),
    plot.caption = element_text(hjust = 0, size = 14),
    legend.position = "top",
    legend.text = element_text(size = 14, face = "bold"),
    axis.text.y = element_text(size = 12, face = "bold"),
    axis.text.x = element_text(size = 12, face = "bold"),
    strip.text = element_text(size = 16, face = "bold", color = "black"),
    strip.background = element_rect(fill = "white", color = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )
```
